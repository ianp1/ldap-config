###########################################################
#
#
#                   !WARNING!
#
#                This file is generated using
#                Ansible. Do not edit it by hand, as it 
#                may be overwritten!
#
#
###########################################################


define host{
        name                    fablab-servers
        use                     generic-host
        check_period            24x7
        check_interval          5
        retry_interval          1
        max_check_attempts      10
        check_command           check-host-alive
        notification_period     24x7
        notification_interval   30
        notification_options    d,r
        register                0; dont show in register - its a template
}

define hostgroup {
        hostgroup_name          ansible-hosts
        alias                   Ansible hosts
        members                 {{ groups['nagios-monitoring']|join(',') }}
}

define servicegroup {
        servicegroup_name       ansible-hosts-services
        alias                   Services for ansible hosts
}


define service {
        use                     generic-service
        servicegroups           ansible-hosts-services
        hostgroup_name          ansible-hosts
        service_description     PING
        check_command           check_ping!100.0,20%!500.0,60%
}

define service {
        use                     generic-service
        servicegroups           ansible-hosts-services
        hostgroup_name          ansible-hosts
        service_description     Current Load
        check_command           check_nrpe!check_load
}

define service {
        use                     generic-service
        servicegroups           ansible-hosts-services
        hostgroup_name          ansible-hosts
        service_description     Total processes
        check_command           check_nrpe!check_procs
}


define service {
        use                     generic-service
        servicegroups           ansible-hosts-services
        hostgroup_name          ansible-hosts
        service_description     Root partition
        check_command           check_nrpe!check_disk
}


define service {
        use                     generic-service
        servicegroups           ansible-hosts-services
        hostgroup_name          ansible-hosts
        service_description     Local swap
        check_command           check_nrpe!check_swap
}

define service {
        use                     generic-service
        servicegroups           ansible-hosts-services
        hostgroup_name          ansible-hosts
        service_description     SSH
        check_command           check_ssh
}

{% for nagios_host in groups['nagios-monitoring'] %}
define host {
        use                     fablab-servers
        host_name               {{nagios_host}}
        address                 {{hostvars[nagios_host].ansible_host}}
}

{% if "nagios_https_host" in hostvars[nagios_host] %}

define service {
        use                     generic-service
        host_name               {{nagios_host}}
        service_description     HTTPS
        check_command           check_http_vars!-I {{hostvars[nagios_host]["nagios_https_host"]}} -S -C 7 {{ "-p " + hostvars[nagios_host]["nagios_https_port"]|string if "nagios_https_port" in hostvars[nagios_host] }}
}

{% endif %}

{% endfor %}